# ai-team-workflow config
#
# This file is YAML (or JSON) and is parsed via `yaml.safe_load` when available.
#
# Share dir (where registry/task/design/ops live):
# - If set (non-empty), it overrides the default shared state directory.
# - Recommended: absolute path
# - Relative paths are resolved from the skill root (`.codex/skills/ai-team-workflow/`)
#
# Default when unset/empty: <skill_root>/share
share:
  dir: ""

# Backward-compatible (older scripts):
# share_dir: ""

# Team policy (hard constraints)
#
# Notes:
# - 权限/可雇佣关系写在 policy（硬约束）里，不写在角色模板里。
# - 组织树（谁雇佣谁、开几个 dev/qa）由 PM 在运行时决定，但必须满足下面的规则。
team:
  policy:
    # Root role (single root). Non-root roles must be created via spawn (must have a parent).
    root_role: "coord"

    # Project-enabled roles (must have a matching templates/<role>.md).
    enabled_roles:
      - coord
      - pm
      - liaison
      - arch
      - dev
      - qa
      - prod
      - ops

    # Hiring policy (who can spawn which roles). PM decides actual org by spawning,
    # but the role types must be allowed here.
    can_hire:
      coord: [pm, liaison]
      pm: [arch, dev, qa, prod, ops]
      arch: [dev, qa, prod]
      # Optional self-scaling (interns/assistants) by role label (e.g. dev-intern):
      dev: [dev]
      qa: [qa]
      prod: [prod]
      ops: [ops]

    # Broadcast governance
    broadcast:
      allowed_roles: [coord]
      # Default internal broadcast audience should exclude liaison unless explicitly targeted.
      exclude_roles: [liaison]

    # Direct communication governance (who can DM/ask whom without handoff)
    comm:
      # Allow parent<->child communications regardless of role.
      allow_parent_child: true

      # Role-to-role direct communication matrix (bidirectional).
      # Example: dev (including dev interns) can talk to prod/qa directly.
      direct_allow:
        # Anyone can ask coord for routing/authorization.
        coord: [pm, arch, dev, qa, prod, ops, liaison]
        pm: [liaison]
        dev: [prod, qa]
        qa: [prod, dev]
        prod: [dev, qa]

      # Otherwise, cross-branch conversations require a handoff/permit (to avoid relaying).
      require_handoff: true

      # Who can create handoffs/permits.
      handoff_creators: [coord, pm, arch]

  # Message delivery (hard default behavior)
  # - Full message bodies are stored in {{TEAM_DIR}}/inbox/...
  # - Chat prompts contain only short [INBOX] id=... notifications
  messaging:
    inbox:
      # Max active unread items per sender->recipient thread; older unread are moved to inbox/overflow.
      max_unread_per_thread: 5

  # Agent standby + inbox polling
  #
  # Notes:
  # - "working" agents should proactively check inbox periodically to avoid queue buildup.
  # - "idle" agents do NOT proactively poll inbox; they are woken by `atwf watch-idle` (operator sidecar).
  state:
    # While working, check inbox at least every N seconds.
    inbox_check_interval: 60

    # If a member is idle and new inbox messages arrive, schedule a wakeup after N seconds.
    idle_wake_delay: 60

    # Poll interval for `atwf watch-idle` (seconds).
    watch_interval: 60

    # Minimal wake message injected into Codex TUI (no full body here).
    wake_message: "INBOX wake: you have unread messages. Run: bash .codex/skills/ai-team-workflow/scripts/atwf inbox"
